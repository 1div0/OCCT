puts "==========="
puts "BUC60918"
puts "OCC85"
puts "==========="
puts ""
###############################
## Shape drawn in transparency mode does not always eclipse another shapes
###############################

puts "=================================="
puts "It takes visual check for this BUG"
puts "=================================="

pload OCAF

box b2 20 20 20 5 5 5 
box b3 30 30 30
box b4 10 20 25 7 7 7 
explode b3 f

NewDocument D
SetShape D 0:1:1 b3_2
SetShape D 0:1:2 b2
SetShape D 0:1:3 b4
AISSet   D 0:1:1 NS
AISSet   D 0:1:2 NS
AISSet   D 0:1:3 NS

AISInitViewer D
AISMaterial D 0:1:1 plastic
AISMaterial D 0:1:2 plastic
AISMaterial D 0:1:3 plastic
AISTransparency D 0:1:1 0.6
AISColor D 0:1:1 1
AISDisplay D 0:1:1
AISDisplay D 0:1:2
AISDisplay D 0:1:3
vfit
vsetdispmode 1

box b 10 10 10 
SetShape D 0:1:4 b
AISSet D 0:1:4 NS
AISDisplay D 0:1:4

if { [array get env os_type] != "" } {
    set os $env(os_type)
}
if { [string compare $os "windows"] == 0 } {
    set x1 260
    set y1 170
    set rd_ch 77647
    set gr_ch 54901
    set bl_ch 9019
} else {
    set x1 255
    set y1 105
    set rd_ch 78039
    set gr_ch 55294
    set bl_ch 9411
}

QAUpdateLights
set color [QAGetPixelColor ${x1} ${y1}]
regexp {RED +: +([-0-9.+eE]+)} $color full rd
regexp {GREEN +: +([-0-9.+eE]+)} $color full gr
regexp {BLUE +: +([-0-9.+eE]+)} $color full bl

set rd_int [expr int($rd * 1.e+05)]
set gr_int [expr int($gr * 1.e+05)]
set bl_int [expr int($bl * 1.e+05)]

if { ${rd_int} != ${rd_ch} || ${gr_int} != ${gr_ch} || ${bl_int} != ${bl_ch} } {
    puts "Error : colors are not equal"
}

set only_screen 1


